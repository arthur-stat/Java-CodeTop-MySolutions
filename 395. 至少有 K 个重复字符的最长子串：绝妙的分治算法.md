题目简述：

> 给你一个字符串 `s` 和一个整数 `k` ，请你找出 `s` 中的最长子串， 要求该子串中的每一字符出现次数都不少于 `k` 。返回这一子串的长度。
>
> 如果不存在这样的子字符串，则返回 0。

题目链接：[395. 至少有 K 个重复字符的最长子串](https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters/)

# 分治算法

## 思路

找到 `s` 中所有重复频数小于 `k` 的字符，那么这些字符均不可能被包含在任何符合要求的子串中。因此，将这些字符作为分割点以分割字符串，得到一系列子串。然后，对子串们递归地、分治地重复这一过程，直到找出满足条件的子串，或子串被证明不可能是解。

该解法学习自 [分治 + 简单剪枝, 轻松100%](https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters/solutions/623933/fen-zhi-jian-dan-jian-zhi-qing-song-100-ym8se/)（嗯，诚不欺我？分治算法的实现确实是 100%）

![分治算法](images\395.png)

## 代码

算法的平均时间复杂度为 $O(n\log n)$，除递归栈以外的空间复杂度为 $O(1)$。

```java
class Solution {

    private char[] s;
    private int k;

    public int longestSubstring(String s, int k) {
        this.s = s.toCharArray();
        this.k = k;
        return devide(0, s.length() - 1);
    }

    private int devide(int l, int r) {
        if (l < 0 || r >= s.length || r - l + 1 < k) return 0;

        int[] freq = new int[26];
        for (int i = l; i <= r; i++) freq[s[i] - 'a']++;

        boolean valid = true;
        for (int f : freq) {
            if (f < k && f != 0) {
                valid = false;
                break;
            }
        }
        if (valid) return r - l + 1;

        int res = 0;
        int left = l;
        for (int i = l; i <= r; i++) {
            if (freq[s[i] - 'a'] < k) {
                res = Math.max(res, devide(left, i - 1));
                left = i + 1;
            }
        }
        res = Math.max(res, devide(left, r));

        return res;
    }
}
```

# 枚举不重复字符数（滑动窗口）

我认为滑动窗口的解决方案很不直观，颇有些 “没有条件，创造条件” 的意思。

本问题我更推荐分治算法。

## 思路

请直接参考 [【宫水三叶の相信科学系列】为什么不能用「滑动窗口」？以及如何发掘题目性质](https://leetcode.cn/problems/longest-substring-with-at-least-k-repeating-characters/solutions/624045/xiang-jie-mei-ju-shuang-zhi-zhen-jie-fa-50ri1/)。因为我就是从这篇分析中明白了本方法的原理。

简而言之是，原本的条件不足以保证滑动窗口的单调性。

为滑动窗口施加额外条件 “不重复元素数量不超过 `m` 个”，遍历 `m = 1` 至 `m = 26`，对于每个 `m` 都类似于一个 [386 · 最多有k个不同字符的最长子字符串](https://www.lintcode.com/problem/386/) 子问题（力扣 340.），可以应用滑动窗口。
