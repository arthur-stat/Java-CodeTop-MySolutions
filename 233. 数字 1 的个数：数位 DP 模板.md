题目简述：

> 给定一个整数 `n`，计算所有小于等于 `n` 的非负整数中数字 `1` 出现的个数。

题目链接：[233. 数字 1 的个数](https://leetcode.cn/problems/number-of-digit-one/)

# 数位 DP

## 模板

这类问题通常都可以直接套数位 DP 的模板。

数位 DP 中公式化的状态定义通常为：`dp[pos][state][tight][lead]`，其中：

- `pos`：当前处理数字的位数，通常从高位至低位遍历

- `state`：需要计算的 “特征”，常见有

  - 当前出现了多少次 `k`，或者附带一些限定条件，例如当前所有偶数位出现了多少次 `k`
  - 余数为 `k`
  - 当前位数和为 `k`
  - 前一位数字（考虑数字连续方面的问题）

  对于本问题，`state` 就是出现了多少次 `1`

  要确保 `state` 的设计能够使记忆化搜索合法，四元组必须唯一确定一个结果，上述 `state` 示例均能被证明有能力确保这一点

- `tight`：此前的数字构造是否达到上界，这决定了当前数码是否被允许任选

- `lead`：是否位于前导零

然后，在构造数字的大框架下，用带有记忆化搜索的回溯算法计算 DP 数组。

## 代码

```JAVA
class Solution {

    private int[][][][] dp;
    private int[] digitArr;
    private int len;

    public int countDigitOne(int n) {
        len = 0;
        int t = n;
        while (t > 0) {
            t /= 10;
            len++;
        }
        digitArr = new int[len];
        for (int i = len - 1; i >= 0; i--) {
            digitArr[i] = n % 10;
            n /= 10;
        }

        // init
        dp = new int[len][len + 1][2][2];
        for (int i = 0; i < len; i++) {
            for (int j = 0; j <= len; j++) {
                for (int a = 0; a < 2; a++) {
                    for (int b = 0; b < 2; b++) {
                        dp[i][j][a][b] = -1;
                    }
                }
            }
        }

        return dfs(0, 0, 1, 1);
    }

    private int dfs(int pos, int state, int tight, int lead) {
        if (pos == len) return state;
        if (dp[pos][state][tight][lead] != -1) return dp[pos][state][tight][lead];

        int up = (tight == 1) ? digitArr[pos] : 9;
        int res = 0;

        for (int d = 0; d <= up; d++) {
            int nextTight = (tight == 1 && d == up) ? 1 : 0;
            int nextLead  = (lead == 1 && d == 0) ? 1 : 0;
            int add = (d == 1) ? 1 : 0;

            res += dfs(pos + 1, state + add, nextTight, nextLead);
        }

        dp[pos][state][tight][lead] = res;
        return res;
    }
}
```

# 找规律？

## 思路

数位 DP 比较重量级，这个问题可能这个方法才是开发岗位面试题目解法的轻量选择。

[LCR 162. 数字 1 的个数（清晰图解）](https://leetcode.cn/problems/1nzheng-shu-zhong-1chu-xian-de-ci-shu-lcof/solutions/229751/mian-shi-ti-43-1n-zheng-shu-zhong-1-chu-xian-de-2/)